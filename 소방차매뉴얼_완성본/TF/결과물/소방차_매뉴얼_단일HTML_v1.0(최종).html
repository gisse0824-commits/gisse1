<!doctype html>
<html lang="ko" data-app-version="1.0">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>소방차 매뉴얼 | 단일 HTML</title>
  <meta name="description" content="펌프차 중심 소방차 매뉴얼 — 오프라인에서도 작동하는 단일 HTML" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: blob:; img-src 'self' data:; media-src 'self' data:; style-src 'self' 'unsafe-inline';" />
  <style>
    /* ===== CSS 리셋 & 토큰 ===== */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin:0; padding:0; height:100%; }
    :root{
      --bg: #0b0f14;
      --panel: #0f151d;
      --muted: #96a0aa;
      --text: #e8eef5;
      --brand: #1aa3ff;
      --accent: #1bd19e;
      --danger: #ff3b4f;
      --warn: #ffb020;
      --ok: #2dd36f;
      --border: #1e2630;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius-sm: 12px;
      --focus: 0 0 0 3px rgba(26,163,255,.35);
      --font: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto, "Noto Sans KR", Apple SD Gothic Neo, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7fbff; --panel:#ffffff; --text:#0a1623; --muted:#5e6a76; --border:#e6edf5; --shadow: 0 10px 30px rgba(2,12,24,.08);
      }
    }

    body{ font-family: var(--font); background: linear-gradient(180deg, #1a1d35 0%, #0d0f1f 50%, #1a1d35 100%); color: var(--text); }
    a{ color: var(--brand); text-decoration: none; }
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible { outline: none; box-shadow: var(--focus); border-radius: 10px; }
    .visually-hidden{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }

    /* ===== 공통 구성 ===== */
    .container{ max-width:1200px; margin:0 auto; padding:24px; }
    .card{ background: rgba(15,21,29,0.7); border:1px solid rgba(26,163,255,0.2); border-radius: var(--radius); box-shadow: 0 8px 32px rgba(0,0,0,0.4); backdrop-filter: blur(10px); }
    .p-24{ padding:24px; } .p-16{ padding:16px; }
    .mt-8{ margin-top:8px; } .mt-12{ margin-top:12px; } .mt-16{ margin-top:16px; } .mt-24{ margin-top:24px; }
    .mb-8{ margin-bottom:8px;} .mb-16{ margin-bottom:16px;} .mb-24{ margin-bottom:24px;}
    .grid{ display:grid; gap:16px; }
    .grid-2{ grid-template-columns: 280px 1fr; }
    .row{ display:flex; gap:12px; align-items:center; }
    .tag{ display:inline-flex; align-items:center; gap:8px; border:1px solid rgba(26,163,255,0.3); background:linear-gradient(180deg, rgba(26,163,255,.1), rgba(26,163,255,.05)); padding:10px 14px; border-radius:999px; font-weight:600; cursor:pointer; color: #ffffff; transition: all 0.3s ease; }
    .tag:hover{ background:linear-gradient(180deg, rgba(26,163,255,.2), rgba(26,163,255,.1)); box-shadow: 0 4px 12px rgba(26,163,255,0.3); }
    .chip{ display:inline-flex; align-items:center; gap:6px; border:1px dashed rgba(26,163,255,0.3); padding:6px 10px; border-radius:999px; font-size:12px; color: rgba(255,255,255,0.7); }
    .muted{ color: rgba(255,255,255,0.6); }
    .btn{ display:inline-flex; align-items:center; gap:10px; background: linear-gradient(180deg, rgba(26,163,255,.25), rgba(26,163,255,.15)); border:1px solid rgba(26,163,255,0.4); padding:12px 16px; border-radius: 12px; cursor:pointer; font-weight:700; color: #ffffff; transition: all 0.3s ease; }
    .btn:hover{ background: linear-gradient(180deg, rgba(26,163,255,.35), rgba(26,163,255,.25)); box-shadow: 0 4px 15px rgba(26,163,255,0.4); }
    .btn.secondary{ background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06)); border-color: rgba(255,255,255,0.2); }
    .btn.secondary:hover{ background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.1)); }
    .btn.danger{ background: linear-gradient(180deg, rgba(255,59,79,.25), rgba(255,59,79,.15)); border-color: rgba(255,59,79,0.4); }
    .btn.danger:hover{ background: linear-gradient(180deg, rgba(255,59,79,.35), rgba(255,59,79,.25)); }
    .kbd{ font-family: var(--mono); font-size:12px; border:1px solid rgba(26,163,255,0.3); padding:2px 6px; border-radius:8px; background: rgba(26,163,255,0.1); color: #ffffff; }
    .progress{ height:10px; background:rgba(255,255,255,.1); border-radius:999px; overflow:hidden; border:1px solid rgba(26,163,255,0.3); }
    .progress > span{ display:block; height:100%; background: linear-gradient(90deg, #1aa3ff, #0d8ae6); }

    /* ===== 홈(검색) ===== */
    #home{ min-height:100dvh; display:grid; place-items:center; padding:24px; background: linear-gradient(180deg, rgba(26,29,53,0.95) 0%, rgba(13,15,31,1) 50%, rgba(26,29,53,0.95) 100%); }
    .hero{ text-align:center; max-width:900px; }
    .logo{ font-weight:900; font-size:clamp(48px, 6vw, 72px); letter-spacing:1px; background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 50%, #ff3838 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 20px; }
    .logo-prefix{ font-size: clamp(48px, 6vw, 72px); color: #ff4757; font-weight: 900; margin-right: 8px; }
    .sub{ color: #ffffff; margin-top:16px; font-size: clamp(16px, 2vw, 20px); font-weight: 500; }
    .search{ display:flex; gap:12px; margin:40px auto 20px; max-width:800px; background: rgba(30,35,50,0.8); padding: 8px; border-radius: 50px; border: 2px solid rgba(26,163,255,0.3); box-shadow: 0 0 40px rgba(26,163,255,0.2); }
    .search input{ flex:1; padding:18px 28px; border-radius: 50px; border:none; background: transparent; color:#ffffff; font-size:17px; outline: none; }
    .search input::placeholder{ color: rgba(255,255,255,0.5); }
    .search button{ background: linear-gradient(135deg, #1aa3ff 0%, #0d8ae6 100%); border: none; border-radius: 50px; padding: 14px 32px; color: white; font-weight: 700; font-size: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(26,163,255,0.4); }
    .search button:hover{ transform: translateY(-2px); box-shadow: 0 6px 20px rgba(26,163,255,0.6); }

    /* ===== 앱 레이아웃 ===== */
    #app{ display:none; min-height:100dvh; background: linear-gradient(180deg, #1a1d35 0%, #0d0f1f 50%, #1a1d35 100%); }
    header.appbar{ position:sticky; top:0; z-index:10; backdrop-filter: blur(12px); background: rgba(26,29,53,0.85); border-bottom:1px solid rgba(26,163,255,0.2);
      display:flex; align-items:center; gap:16px; padding:12px 18px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    .app-logo{ font-weight:900; letter-spacing:.3px; color: #ff4757; font-size: 18px; }
    .leftnav{ position:sticky; top:80px; align-self:start; max-height: calc(100dvh - 100px); overflow-y:auto; overflow-x:hidden; border:1px solid rgba(26,163,255,0.3); border-radius: var(--radius); background: rgba(15,21,29,0.95); backdrop-filter: blur(10px); z-index: 5; }
    .leftnav a{ display:flex; align-items:center; gap:10px; padding:12px 14px; color:#ffffff; border-bottom:1px solid rgba(26,163,255,0.1); transition: all 0.3s ease; border-left: 3px solid transparent; }
    .leftnav a:hover{ background: linear-gradient(90deg, rgba(26,163,255,.15), transparent 80%); }
    .leftnav a[aria-current="true"]{ background: linear-gradient(90deg, rgba(26,163,255,.25), transparent 80%); border-left-color: #1aa3ff; font-weight: 700; box-shadow: 0 0 15px rgba(26,163,255,0.2); }
    .content{ min-height:60dvh; padding-bottom: 40vh; }
    .section{ scroll-margin-top: 90px; }
    .section:last-child{ margin-bottom: 0; }

    /* ===== 표 ===== */
    table{ width:100%; border-collapse:separate; border-spacing:0; border:1px solid rgba(26,163,255,0.3); border-radius:14px; overflow:hidden; background: rgba(15,21,29,0.5); }
    thead th{ text-align:left; background: linear-gradient(180deg, rgba(26,163,255,.2), rgba(26,163,255,.1)); padding:12px 12px; position:sticky; top:0; color: #ffffff; font-weight: 700; }
    tbody td{ border-top:1px solid rgba(26,163,255,0.2); padding:12px 12px; vertical-align:top; color: rgba(255,255,255,0.9); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    tbody tr:hover{ background: rgba(26,163,255,0.05); }
    code{ font-family: var(--mono); background: rgba(26,163,255,.15); border:1px solid rgba(26,163,255,0.3); padding:2px 6px; border-radius:8px; color: #1aa3ff; }
    details{ background: rgba(15,21,29,0.5); border: 1px solid rgba(26,163,255,0.2); border-radius: 12px; padding: 16px; }
    details summary{ cursor: pointer; font-weight: 700; color: #ffffff; transition: all 0.3s ease; }
    details summary:hover{ color: #1aa3ff; }
    details[open] summary{ margin-bottom: 12px; color: #1aa3ff; }
    h2, h3, h4{ color: #ffffff; }
    strong{ color: #1aa3ff; }
    ul, ol{ color: rgba(255,255,255,0.9); }
    p{ color: rgba(255,255,255,0.85); }

    /* ===== 프린트 ===== */
    @media print{
      header.appbar, .leftnav, #home{ display:none !important; }
      #app{ display:block !important; }
      .container{ max-width:100%; padding:0; }
      .card{ box-shadow:none; border-color:#ccc; }
      a[href]:after{ content:" (" attr(href) ")"; font-size:12px; color:#555; }
    }
    /* ===== 좌측 목차를 화면 왼쪽에 완전히 붙이기 ===== */
    #app .container{ max-width:100%; margin:0; padding:24px 24px 24px 0; }
    #app .leftnav{ border-top-left-radius:0; border-bottom-left-radius:0; }
  </style>
</head>
<body>
  <!-- ===== 홈(검색) ===== -->
  <main id="home" aria-labelledby="home-title">
    <div class="hero">
      <div class="chip" style="background: rgba(255,71,87,0.15); border-color: rgba(255,71,87,0.3); color: #ff4757; font-size: 20px; padding: 14px 24px; font-weight: 700;">인천소방본부 119소방위키</div>
      <h1 id="home-title" class="logo"><span class="logo-prefix">119</span>소방차 매뉴얼</h1>
      <form class="search" id="searchForm" autocomplete="off">
        <label for="q" class="visually-hidden">검색어</label>
        <input id="q" name="q" inputmode="search" placeholder="키워드를 입력하세요." aria-describedby="hint" />
        <button type="submit" aria-label="검색 실행">검색</button>
      </form>
      <div class="row" role="list" aria-label="빠른 시작" style="justify-content: center; margin-top: 24px; flex-wrap: wrap;">
        <button class="tag" role="listitem" data-open="pump" style="background: rgba(26,163,255,0.15); border-color: rgba(26,163,255,0.4); color: #1aa3ff; font-size: 15px; padding: 12px 20px;">🚒 펌프차 매뉴얼 열기</button>
        <button class="tag" role="listitem" data-open="water" style="background: rgba(27,209,158,0.15); border-color: rgba(27,209,158,0.4); color: #1bd19e; font-size: 15px; padding: 12px 20px;">🚚 물탱크차 매뉴얼 열기</button>
        <button class="tag" role="listitem" data-open="ladder" style="background: rgba(255,176,32,0.15); border-color: rgba(255,176,32,0.4); color: #ffb020; font-size: 15px; padding: 12px 20px;">🪜 고가차 매뉴얼 열기</button>
      </div>
      <p id="hint" class="muted mt-16" style="color: rgba(255,255,255,0.4); font-size: 13px;">오프라인 단일 HTML · 접근성 최적화 · 프린트 지원</p>
    </div>
  </main>

  <!-- ===== 앱(매뉴얼) ===== -->
  <div id="app" role="application" aria-label="매뉴얼 앱">
    <header class="appbar">
      <strong class="app-logo">🚒 소방차 매뉴얼</strong>
      <nav class="row" aria-label="바로가기">
        <button class="btn secondary" id="backHome" title="홈으로">〈 홈</button>
        <button class="btn" id="printBtn" title="인쇄">🖨️ 인쇄</button>
        <button class="btn" id="collapseAll" title="전체 접기/펼치기">▾ 아코디언</button>
      </nav>
    </header>

    <div class="container grid grid-2">
      <!-- 좌측 내비 -->
      <nav class="leftnav card" id="toc" aria-label="목차"></nav>

      <!-- 우측 콘텐츠 -->
      <section class="content grid" id="manualContent"></section>
    </div>
  </div>

  <!-- ===== 템플릿 ===== -->
  <template id="tpl-section">
    <article class="section card p-24" data-section>
      <h2 class="row" data-title><span data-emoji>📑</span><span data-text>제목</span></h2>
      <div class="muted" data-meta></div>
      <div class="mt-16" data-body></div>
    </article>
  </template>

  <!-- ===== 인라인 아이콘(SVG) ===== -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="ic-mainvalve" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M4 12h16M12 4v16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </symbol>
    <symbol id="ic-pto" viewBox="0 0 24 24">
      <rect x="3" y="6" width="18" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M9 6v-2h6v2M12 9v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </symbol>
    <symbol id="ic-air" viewBox="0 0 24 24">
      <path d="M3 12c3-4 6-4 9 0s6 4 9 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <circle cx="12" cy="12" r="2" fill="currentColor"/>
    </symbol>
    <symbol id="ic-water" viewBox="0 0 24 24">
      <path d="M12 3c4 6 7 8.5 7 12a7 7 0 1 1-14 0c0-3.5 3-6 7-12z" fill="none" stroke="currentColor" stroke-width="2"/>
    </symbol>
  </svg>

  <script>
  ;(() => {
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    // ===== 데이터(시범: 펌프차) =====
    const DATA = {
      vehicle: {
        key: 'pump',
        name: '펌프차',
        model: '예) 2024 XYZ-1500',
        specs: { 크기:'L 7.2m × W 2.3m × H 3.1m', 물탱크:'1500 L', 펌프정격:'1500 L/min @ 1.0 MPa', 연료:'디젤' },
      },
      sections: [
        {
          id:'intro', emoji:'🚒', title:'차량소개 및 제원',
          meta:'사진·다이어그램 권장 — 시범 데이터',
          body: ({specs}) => /*html*/`
            <div class="card p-16 mt-16">
              <div style="display: flex; gap: 16px; align-items: stretch;">
                <div style="flex: 2; display: flex; flex-direction: column;">
                  <h3 style="margin-top: 0;">소방차 제원(요약)</h3>
                  <table style="flex: 1;" aria-label="소방차 제원">
                    <thead>
                      <tr><th style="width:40%;">항목</th><th>내용</th></tr>
                    </thead>
                  <tbody>
                    <tr><td>차종</td><td>펌프차</td></tr>
                  <tr><td>전장 × 전폭 × 전고 (mm)</td><td>〈입력〉</td></tr>
                  <tr><td>총중량 (kg)</td><td>〈입력〉</td></tr>
                  <tr><td>물탱크 용량 (L)</td><td>〈입력〉</td></tr>
                  <tr><td>폼탱크 용량 (L)</td><td>〈입력〉</td></tr>
                </tbody>
                  </table>
                </div>
                <div style="flex: 1; display: flex; flex-direction: column;">
                  <h3 style="margin-top: 0;">차량소개 영상</h3>
                  <video controls style="width:100%; height: 100%; margin-top:12px; border-radius:12px; object-fit: cover;">
                    <source src="카카오톡 받은 파일/차량소개.mp4" type="video/mp4">
                    귀하의 브라우저는 비디오 태그를 지원하지 않습니다.
                  </video>
                </div>
            </div>
            </div>`
        },
        {
          id:'ops', emoji:'🧭', title:'표준 방수 절차',
          meta:'펌프차 표준 방수 절차',
          body: () => /*html*/`
            <div class="grid">
              <table aria-label="현장 안전 3선">
                <thead><tr><th colspan="2">현장 안전 3선(주-기-고)</th></tr></thead>
                <tbody>
                  <tr><td>주차 브레이크 채움 → 변속기 기어 중립(N) → 바퀴 고임목 설치</td></tr>
                </tbody>
              </table>

              <table aria-label="방수 절차 3단계" class="mt-16">
                <thead><tr><th style="width:30%">단계</th><th>절차</th></tr></thead>
                <tbody>
                  <tr><td>1. 메인밸브 선개방</td><td>물탱크 → 펌프 충수</td></tr>
                  <tr><td>2. PTO 연결</td><td>펌프 가동</td></tr>
                  <tr><td>3. 방수구 개방</td><td>가압수 → 호스/관창 방수</td></tr>
                </tbody>
              </table>

              <table aria-label="메인밸브 우선 이유" class="mt-16">
                <thead><tr><th colspan="2">⚠️ 왜 메인밸브가 먼저? (메커니컬 실 보호)</th></tr></thead>
                <tbody>
                  <tr><td>메인밸브 미개방 상태에서 PTO 먼저 연결 = 공회전 → 펌프 과열·손상</td></tr>
                </tbody>
              </table>

              <table aria-label="체크리스트" class="mt-16">
                <thead><tr><th>📋 한 줄 체크리스트</th></tr></thead>
                <tbody>
                  <tr><td style="color: white;"><strong style="color: white;">"주-기-고 → 메-P-방"을 구호처럼</strong></td></tr>
                  <tr><td style="color: white;">항상 '<strong style="color: white;">퍼스트 메인밸브(First Main-valve)</strong>'!</td></tr>
                  <tr><td style="color: white;">PTO 버튼은 곧 펌프 ON이라는 뜻임을 상기</td></tr>
                </tbody>
              </table>

              <div class="card p-16 mt-24">
                <h3>소방차 물 공급 시스템 시뮬레이션</h3>
                <p class="mt-8">3D 인터랙티브 시뮬레이션으로 소방차의 물 공급 시스템을 직접 조작해보세요.</p>
                <iframe src="카카오톡 받은 파일/firefighter_water_system_fixed_7.html" style="width: 100%; height: 600px; border: none; border-radius: 12px; margin-top: 16px;"></iframe>
              </div>
            </div>`
        },
        {
          id:'special', emoji:'🎵', title:'오디오 매뉴얼',
          meta:'',
          body: () => /*html*/`
            <style>
                .audio-body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    margin: 0;
                    background: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 50%, #FF6B6B 100%);
                    position: relative;
                    overflow: hidden;
                    padding: 40px 0;
                }

                .fire-truck-bg {
                    position: fixed;
                    font-size: 60px;
                    opacity: 0.1;
                    animation: moveTruck 20s linear infinite;
                }

                @keyframes moveTruck {
                    0% { transform: translateX(-100px) rotate(0deg); }
                    50% { transform: translateX(100vw) rotate(5deg); }
                    100% { transform: translateX(-100px) rotate(0deg); }
                }

                .fire-truck-bg:nth-child(1) { top: 10%; animation-delay: 0s; }
                .fire-truck-bg:nth-child(2) { top: 40%; animation-delay: 7s; }
                .fire-truck-bg:nth-child(3) { top: 70%; animation-delay: 14s; }

                .audio-container {
                    background: linear-gradient(145deg, #ffffff, #f0f0f0);
                    padding: 40px;
                    border-radius: 25px;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                    max-width: 900px;
                    margin: 0 auto;
                    position: relative;
                    z-index: 1;
                    border: 3px solid #FF4444;
                }

                .audio-header {
                    text-align: center;
                    margin-bottom: 30px;
                    position: relative;
                }

                .fire-truck-icon {
                    font-size: 80px;
                    animation: bounce 2s ease-in-out infinite;
                    display: inline-block;
                    filter: drop-shadow(0 4px 8px rgba(255, 68, 68, 0.3));
                }

                @keyframes bounce {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-20px); }
                }

                .audio-container h1 {
                    text-align: center;
                    color: #FF4444;
                    margin: 15px 0 10px 0;
                    font-size: 2em;
                    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
                }

                .audio-subtitle {
                    text-align: center;
                    color: #666;
                    font-size: 1.1em;
                    margin-bottom: 10px;
                }

                .fire-line {
                    height: 3px;
                    background: linear-gradient(90deg, #FF4444, #FFD700, #FF4444);
                    border-radius: 2px;
                    margin: 15px 0;
                }

                .video-wrapper {
                    position: relative;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                    border: 3px solid #FFD700;
                }

                .video-wrapper video {
                    width: 100%;
                    display: block;
                    background: #000;
                }

                .decorative-icons {
                    display: flex;
                    justify-content: space-around;
                    margin: 20px 0;
                    font-size: 35px;
                }

                .decorative-icons span {
                    animation: pulse-icon 2s ease-in-out infinite;
                    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
                }

                .decorative-icons span:nth-child(2) { animation-delay: 0.3s; }
                .decorative-icons span:nth-child(3) { animation-delay: 0.6s; }
                .decorative-icons span:nth-child(4) { animation-delay: 0.9s; }
                .decorative-icons span:nth-child(5) { animation-delay: 1.2s; }

                @keyframes pulse-icon {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.2); }
                }

                .audio-info {
                    margin-top: 20px;
                    padding: 20px;
                    background: linear-gradient(135deg, #FFF5E6 0%, #FFE6E6 100%);
                    border-radius: 12px;
                    font-size: 15px;
                    color: #333;
                    border-left: 5px solid #FF4444;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                }

                .audio-info strong {
                    color: #FF4444;
                }

                .info-line {
                    margin: 8px 0;
                    display: flex;
                    align-items: center;
                }

                .info-line::before {
                    content: '🔥';
                    margin-right: 8px;
                }

                .siren-light {
                    position: absolute;
                    top: -10px;
                    right: -10px;
                    width: 20px;
                    height: 20px;
                    background: #FF4444;
                    border-radius: 50%;
                    animation: siren 1s ease-in-out infinite;
                    box-shadow: 0 0 20px #FF4444;
                }

                @keyframes siren {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.3; }
                }

                .video-section {
                    margin-top: 40px;
                }

                .video-section .card {
                    background: linear-gradient(135deg, rgba(138,43,226,0.15) 0%, rgba(75,0,130,0.1) 100%);
                    border: 2px solid rgba(138,43,226,0.4);
                    box-shadow: 0 8px 32px rgba(138,43,226,0.3), 0 0 60px rgba(138,43,226,0.15);
                    padding: 24px;
                    border-radius: 16px;
                }

                .video-section h3 {
                    margin: 0;
                    font-size: 24px;
                    background: linear-gradient(135deg, #9d4edd 0%, #c77dff 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                }

                .video-section video {
                    width: 100%;
                    max-width: 800px;
                    border-radius: 16px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                    border: 2px solid rgba(138,43,226,0.3);
                }
            </style>

            <div class="audio-body">
                <div class="fire-truck-bg">🚒</div>
                <div class="fire-truck-bg">🚒</div>
                <div class="fire-truck-bg">🚒</div>

                <div class="audio-container">
                    <div class="siren-light"></div>
                    <div class="audio-header">
                        <div class="fire-truck-icon">🚒</div>
                        <h1>소방차 팟캐스트</h1>
                        <div class="audio-subtitle">🎧 소방안전 교육 미디어 플레이어 🎧</div>
                        <div class="fire-line"></div>
                    </div>

                    <div class="decorative-icons">
                        <span>🔥</span>
                        <span>🚨</span>
                        <span>🧯</span>
                        <span>👨‍🚒</span>
                        <span>🚑</span>
                    </div>

                    <div class="video-wrapper">
                        <video controls preload="metadata">
                            <source src="카카오톡 받은 파일/오디오.mp4" type="video/mp4">
                            브라우저가 비디오 태그를 지원하지 않습니다.
                        </video>
                    </div>

                    <div class="audio-info">
                        <div class="info-line"><strong>파일명:</strong> 오디오.mp4</div>
                        <div class="info-line"><strong>파일 크기:</strong> 약 31 MB</div>
                        <div class="info-line"><strong>설명:</strong> 소방안전 교육 팟캐스트 플레이어입니다</div>
                        <div class="info-line"><strong>기능:</strong> 재생, 일시정지, 음량 조절, 전체화면</div>
                    </div>
                </div>

                <div class="video-section" style="max-width: 900px; margin: 40px auto 0;">
                    <div class="audio-container">
                        <div class="siren-light"></div>
                        <div class="audio-header">
                            <div class="fire-truck-icon">🎬</div>
                            <h1>소방차 동영상 매뉴얼</h1>
                            <div class="audio-subtitle">📹 소방안전 영상 교육 플레이어 📹</div>
                            <div class="fire-line"></div>
                        </div>

                        <div class="decorative-icons">
                            <span>🔥</span>
                            <span>🚨</span>
                            <span>🧯</span>
                            <span>👨‍🚒</span>
                            <span>🚑</span>
                        </div>

                        <div class="video-wrapper">
                            <video controls preload="metadata">
                                <source src="카카오톡 받은 파일/영상.mp4" type="video/mp4">
                                브라우저가 비디오 태그를 지원하지 않습니다.
                            </video>
                        </div>

                        <div class="audio-info">
                            <div class="info-line"><strong>파일명:</strong> 영상.mp4</div>
                            <div class="info-line"><strong>설명:</strong> 소방안전 교육 동영상 플레이어입니다</div>
                            <div class="info-line"><strong>기능:</strong> 재생, 일시정지, 음량 조절, 전체화면</div>
                        </div>
                    </div>
                </div>
            </div>`
        },
        {
          id:'faults', emoji:'🧯', title:'고장 및 응급조치',
          meta:'장치별 고장–원인–응급조치 매핑',
          body: () => /*html*/`
            <style>
                .problems-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                    gap: 30px;
                    margin-bottom: 40px;
                }

                .problem-card {
                    background: white;
                    border-radius: 12px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                    transition: transform 0.3s ease, box-shadow 0.3s ease;
                    cursor: pointer;
                }

                .problem-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
                }

                .card-header {
                    padding: 25px;
                    color: white;
                    font-weight: bold;
                    font-size: 18px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                }

                .card-icon {
                    font-size: 36px;
                }

                .problem-1 .card-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
                .problem-2 .card-header { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
                .problem-3 .card-header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
                .problem-4 .card-header { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
                .problem-5 .card-header { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
                .problem-6 .card-header { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
                .problem-7 .card-header { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
                .problem-8 .card-header { background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%); }
                .problem-9 .card-header { background: linear-gradient(135deg, #2e2e78 0%, #662d91 100%); }

                .card-content {
                    padding: 25px;
                }

                .section {
                    margin-bottom: 20px;
                }

                .section-title {
                    font-weight: 700;
                    color: #333;
                    margin-bottom: 10px;
                    font-size: 13px;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    color: #0066cc;
                }

                .section-content {
                    background: #f9f9f9;
                    padding: 12px;
                    border-radius: 6px;
                    font-size: 14px;
                    line-height: 1.6;
                    color: #555;
                    border-left: 4px solid #0066cc;
                }

                .arrow-flow {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    margin: 12px 0;
                    font-size: 13px;
                }

                .arrow-flow span {
                    color: #0066cc;
                    font-weight: bold;
                }

                .flow-diagram {
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    margin-top: 40px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }

                .flow-diagram h2 {
                    color: #333;
                    margin-bottom: 25px;
                    text-align: center;
                    font-size: 24px;
                }

                .flow-steps {
                    display: flex;
                    justify-content: space-around;
                    align-items: center;
                    flex-wrap: wrap;
                    gap: 20px;
                }

                .flow-step {
                    flex: 1;
                    min-width: 150px;
                    text-align: center;
                }

                .flow-step p {
                    color: #555;
                    font-size: 14px;
                    line-height: 1.6;
                    margin-top: 10px;
                }

                .step-circle {
                    width: 100px;
                    height: 100px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 14px;
                    font-weight: bold;
                    margin: 0 auto 10px;
                    text-align: center;
                }

                .step-1 .step-circle { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
                .step-2 .step-circle { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
                .step-3 .step-circle { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
                .step-4 .step-circle { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

                .arrow-between {
                    font-size: 28px;
                    color: #0066cc;
                }

                .quick-ref {
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    margin-top: 40px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }

                .quick-ref h2 {
                    color: #333;
                    margin-bottom: 20px;
                    font-size: 24px;
                }

                .ref-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 20px;
                }

                .ref-card {
                    background: #f9f9f9;
                    padding: 15px;
                    border-radius: 8px;
                    border-left: 4px solid #0066cc;
                    min-width: 0;
                }

                .ref-card strong {
                    color: #0066cc;
                    display: block;
                    margin-bottom: 8px;
                }

                @media (max-width: 768px) {
                    .problems-grid {
                        grid-template-columns: 1fr;
                    }

                    .flow-steps {
                        flex-direction: column;
                    }

                    .arrow-between {
                        transform: rotate(90deg);
                    }
                }
            </style>

            <div class="problems-grid">
                <!-- 문제 1 -->
                <div class="problem-card problem-1">
                    <div class="card-header">
                        <span class="card-icon">💧</span>
                        <span>문제 1: 흡입 불량</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">수두 형성 안됨</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 에어 침입<br>
                                • 스트레이너 막힘<br>
                                • 수원 수두 부족
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 연결부 누기 점검·체결<br>
                                • 스트레이너 청소<br>
                                • 수심·수두 확보<br>
                                • 프라이밍 재시도
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 2 -->
                <div class="problem-card problem-2">
                    <div class="card-header">
                        <span class="card-icon">〰️</span>
                        <span>문제 2: 토출 불안정</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">토출양 불안정/맥동</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 공기 침입<br>
                                • 릴리프 세팅 부적정
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 공기 배출<br>
                                • 릴리프 재설정<br>
                                • RPM 안정화
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 3 -->
                <div class="problem-card problem-3">
                    <div class="card-header">
                        <span class="card-icon">🫧</span>
                        <span>문제 3: 캐비테이션</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">소음·진동·압력저하</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 과도한 흡입 손실<br>
                                • 수온 상승
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 흡입헤드 저감<br>
                                • 호스 길이 단축<br>
                                • RPM 감소<br>
                                • 대체 수원
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 4 -->
                <div class="problem-card problem-4">
                    <div class="card-header">
                        <span class="card-icon">❄️</span>
                        <span>문제 4: 동결/결빙</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">펌프 작동 불능</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 배수 미실시<br>
                                • 혹한 저온
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 배수 밸브 개방<br>
                                • 부동액 처리<br>
                                • 동결 방지 커버
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 5 -->
                <div class="problem-card problem-5">
                    <div class="card-header">
                        <span class="card-icon">🌡️</span>
                        <span>문제 5: 과열/오버히트</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">높은 온도 감지</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 냉각 불량<br>
                                • 고회전 지속
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • RPM 감소<br>
                                • 라디에이터 점검<br>
                                • 공회전 냉각
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 6 -->
                <div class="problem-card problem-6">
                    <div class="card-header">
                        <span class="card-icon">📊</span>
                        <span>문제 6: 성능 불일치</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">예상과 다른 성능</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 혼합비 세팅 오류<br>
                                • 인젝터 역압
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 혼합비 재설정<br>
                                • 릴리프 확인<br>
                                • 바이패스 조정
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 7 -->
                <div class="problem-card problem-7">
                    <div class="card-header">
                        <span class="card-icon">⚙️</span>
                        <span>문제 7: PTO 체결 불능</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">PTO 작동 불가</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 회전수 과다<br>
                                • 기계식 결합 불량
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 공회전 안정<br>
                                • 클러치 조정<br>
                                • 전문가 상담
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 8 -->
                <div class="problem-card problem-8">
                    <div class="card-header">
                        <span class="card-icon">💡</span>
                        <span>문제 8: 발전기/조명</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">불량/작동 안됨</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 퓨즈 단락<br>
                                • 배선 문제
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 퓨즈 교체<br>
                                • 커넥터 재결합<br>
                                • 에러 확인
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 문제 9 -->
                <div class="problem-card problem-9">
                    <div class="card-header">
                        <span class="card-icon">🔔</span>
                        <span>문제 9: 경광등·사이렌</span>
                    </div>
                    <div class="card-content">
                        <div class="section">
                            <div class="section-title">증상</div>
                            <div class="section-content">미작동</div>
                        </div>
                        <div class="section">
                            <div class="section-title">원인</div>
                            <div class="section-content">
                                • 스위치 고장<br>
                                • 퓨즈/릴레이 문제
                            </div>
                        </div>
                        <div class="section">
                            <div class="section-title">즉시 조치</div>
                            <div class="section-content">
                                • 스위치 확인<br>
                                • 퓨즈 교체<br>
                                • 회로 전환
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 문제해결 플로우 다이어그램 -->
            <div class="flow-diagram">
                <h2>📋 문제 해결 프로세스</h2>
                <div class="flow-steps">
                    <div class="flow-step step-1">
                        <div class="step-circle">① 증상 인식</div>
                        <p>비정상 소리<br>성능 저하 감지</p>
                    </div>
                    <div class="arrow-between">→</div>
                    <div class="flow-step step-2">
                        <div class="step-circle">② 원인 파악</div>
                        <p>가능한 원인 확인<br>체계적 진단</p>
                    </div>
                    <div class="arrow-between">→</div>
                    <div class="flow-step step-3">
                        <div class="step-circle">③ 즉시 조치</div>
                        <p>해결방법 적용<br>상황 개선</p>
                    </div>
                    <div class="arrow-between">→</div>
                    <div class="flow-step step-4">
                        <div class="step-circle">④ 전문가 상담</div>
                        <p>문제 지속 시<br>전문가 호출</p>
                    </div>
                </div>
            </div>

            <!-- 빠른 참고 -->
            <div class="quick-ref">
                <h2>🎯 빠른 참고 (Quick Reference)</h2>
                <div class="ref-grid">
                    <div class="ref-card">
                        <strong>긴급 상황</strong>
                        비정상 소음, 높은 온도, 연기 발생 시 즉시 중지하고 전문가 호출
                    </div>
                    <div class="ref-card">
                        <strong>정기 점검 주기</strong>
                        월 1회: 스트레이너, 냉각액<br>
                        분기 1회: 전체 시스템 점검
                    </div>
                    <div class="ref-card">
                        <strong>수명 연장 팁</strong>
                        정기 유지보수, 신속한 조치, 과부하 방지가 핵심
                    </div>
                    <div class="ref-card">
                        <strong>전문가 필요 시점</strong>
                        기계음 지속, 누수 발생, 성능 미흡 시
                    </div>
                </div>
            </div>`
        },
        {
          id:'law', emoji:'📜', title:'관련법령',
          meta:'소방차 운전자를 위한 교통법규 핵심 요약 및 조문 정리',
          body: () => /*html*/`
            <div class="grid">
              <table aria-label="운전 특례·의무 요약">
                <thead><tr><th style="width:20%">구분</th><th style="width:40%">주요 내용</th><th style="width:20%">법적 근거</th><th>유의 사항</th></tr></thead>
                <tbody>
                  <tr><td>긴급차 지정</td><td>소방차는 긴급자동차</td><td>제2조</td><td>경광등·사이렌 사용 시 특례 인정</td></tr>
                  <tr><td>우선 통행</td><td>다른 차량·보행자는 진로 양보 의무</td><td>제26조</td><td>양보 불이행 시 과태료·벌점</td></tr>
                  <tr><td>신호위반</td><td>출동 목적 시 신호·지시 미준수 가능</td><td>제27조</td><td><strong>교차로 진입 전 일시정지·안전확인 필수</strong></td></tr>
                  <tr><td>중앙선/역주행</td><td>출동 목적 시 가능</td><td>제27조</td><td>안전확보 전제, 사고 시 책임 발생 가능</td></tr>
                  <tr><td>과속</td><td>출동 목적 시 가능</td><td>제27조</td><td>무리한 과속은 책임 커짐</td></tr>
                  <tr><td>보행자 보호</td><td>보행자 충돌 시 특례 적용 어려움</td><td>제27조 단서</td><td>횡단보도·보행밀집 구간 각별 주의</td></tr>
                  <tr><td>갓길 통행</td><td>고속도로 갓길 통행 가능</td><td>제60조</td><td>정체 구간에서 안전거리 확보</td></tr>
                </tbody>
              </table>

              <table aria-label="면허·자격 요약" class="mt-16">
                <thead><tr><th style="width:28%">차량 유형</th><th style="width:34%">차종/중량</th><th>권장 면허(등록증 최종 확인)</th></tr></thead>
                <tbody>
                  <tr><td>펌프차·물탱크차</td><td>총중량 10톤 기준</td><td>10톤 미만: 1종 보통 / 이상: 1종 대형</td></tr>
                  <tr><td>사다리차·고가차</td><td>특수작업형</td><td>1종 대형</td></tr>
                  <tr><td>구조대 차량</td><td>특수작업형</td><td>10톤 미만: 1종 보통 / 이상: 1종 대형</td></tr>
                  <tr><td>지휘차</td><td>승합</td><td>1종 보통(15인 이하)</td></tr>
                  <tr><td>지휘버스</td><td>대형 승합</td><td>1종 대형(16인 이상)</td></tr>
                  <tr><td>구급차</td><td>승합/화물</td><td>2종 보통 또는 1종 보통(차종·중량 기준)</td></tr>
                </tbody>
              </table>
              <p class="muted">※ 차량등록증의 차종/승차정원/중량으로 면허 기준 최종 확인. 상세 기준·예외는 내부 규정과 최신 법령에 따릅니다.</p>

              <table aria-label="법규 핵심요약" class="mt-16">
                <thead><tr><th style="width:30%">구분</th><th>내용</th></tr></thead>
                <tbody>
                  <tr><td>무제한 면책 아님</td><td>소방차는 긴급자동차에 해당하지만, 항상 안전확보가 전제되어야 함</td></tr>
                  <tr><td>특례 인정 조건</td><td>경광등+사이렌 사용과 최대한의 안전확보가 기본 조건</td></tr>
                  <tr><td>보행자 사고 주의</td><td>보행자 사고는 특례 적용이 어려워 운전자 책임이 매우 큼</td></tr>
                </tbody>
              </table>

              <table aria-label="자주 하는 오해" class="mt-16">
                <thead><tr><th style="width:45%">질문</th><th>답변</th></tr></thead>
                <tbody>
                  <tr><td>Q. 사이렌 없이 급하면 특례 가능?</td><td><strong>불가</strong> - 경광등/사이렌 모두 필요함</td></tr>
                  <tr><td>Q. 버스전용차로 통행 절대 불가?</td><td><strong>긴급 목적 수행 중</strong>이라면 <strong>가능</strong></td></tr>
                </tbody>
              </table>

              <table aria-label="주요 조문" class="mt-16">
                <thead><tr><th style="width:25%">조문</th><th>내용</th></tr></thead>
                <tbody>
                  <tr><td>제2조</td><td>긴급자동차 지정</td></tr>
                  <tr><td>제15·16조</td><td>전용차로(버스·노면전차) 통행</td></tr>
                  <tr><td>제29조</td><td>긴급자동차 우선통행</td></tr>
                  <tr><td>제30조</td><td>긴급자동차 특례</td></tr>
                  <tr><td>제60조</td><td>고속도로 갓길 통행</td></tr>
                  <tr><td>제64조</td><td>고속도로 등 정차·주차 금지</td></tr>
                  <tr><td>제158조의2</td><td>긴급자동차 형의 감면</td></tr>
                </tbody>
              </table>

              <p class="muted mt-16">참고: "소방차 운전자를 위한 교통법규 체크리스트" (PDF)</p>
            </div>`
        },
        {
          id:'contacts', emoji:'📞', title:'관련 업체 연락처',
          meta:'정비/부품/장비 점검 등 협력업체 목록',
          body: () => /*html*/`
            <div class="grid">
              <table aria-label="업체 연락처">
                <thead><tr><th style="width:28%;">업체명</th><th style="width:28%;">서비스</th><th style="width:22%;">전화</th><th>비고</th></tr></thead>
                <tbody>
                  <tr style="background: linear-gradient(90deg, rgba(26,163,255,.08), transparent);"><td><strong>인천소방본부</strong></td><td>종합 문의</td><td><strong>010-0000-0000</strong></td><td>24시간 상담 가능</td></tr>
                  <tr><td>예) 인천소방 정비센터</td><td>펌프/밸브 정비</td><td>032-000-0000</td><td>평일 09:00–18:00</td></tr>
                  <tr><td>예) XYZ 호스</td><td>호스/커플링</td><td>02-000-0000</td><td>긴급 출동 가능</td></tr>
                  <tr><td>예) PTO 전문</td><td>PTO/동력전달</td><td>031-000-0000</td><td>부품 당일 배송</td></tr>
                </tbody>
              </table>
              <p class="muted mt-8">실제 연락처는 내부 엑셀에서 불러와 자동 반영 예정(CSV 연동).</p>
            </div>`
        },
      ]
    };

    // ===== 상태 =====
    const state = {
      openManual: null,
      doneSteps: new Set(JSON.parse(localStorage.getItem('doneSteps')||'[]')),
      checklist: JSON.parse(localStorage.getItem('checklist')||'{}'),
      currentSection: localStorage.getItem('currentSection')||'intro',
    };

    // ===== 홈 인터랙션 =====
    document.addEventListener('keydown', (e)=>{ if(e.key === 'g') window.__g=1; else if(window.__g && e.key==='s'){ e.preventDefault(); openManual('pump'); window.__g=0; } });
    document.addEventListener('keyup', (e)=>{ if(e.key==='g') window.__g=0; });
    document.getElementById('searchForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = (document.getElementById('q').value||'').trim();
      if(/펌프차|pump|펌프/.test(q)) openManual('pump');
      else alert('시범에서는 \"펌프차\" 매뉴얼을 제공합니다.');
    });
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-open]');
      if(btn) {
        const type = btn.dataset.open;
        if(type === 'pump') {
          openManual('pump');
        } else if(type === 'water') {
          alert('물탱크차 매뉴얼은 준비 중입니다.');
        } else if(type === 'ladder') {
          alert('고가차 매뉴얼은 준비 중입니다.');
        }
      }
    });

    // ===== 매뉴얼 렌더링 =====
    function openManual(key){
      if(key !== 'pump') return;
      state.openManual = key;
      document.getElementById('home').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      renderManual();
      const first = document.querySelector('#manualContent [data-section] h2');
      if(first) first.tabIndex = -1, first.focus();
    }

    function renderManual(){
      const toc = document.getElementById('toc'); toc.innerHTML = '';
      DATA.sections.forEach(s=>{
        const a = document.createElement('a');
        a.href = `#${s.id}`; a.dataset.id = s.id; a.innerHTML = `<span aria-hidden=\"true\">${s.emoji}</span> ${s.title}`;
        a.setAttribute('aria-current', s.id===state.currentSection);
        a.addEventListener('click', (e)=>{
          e.preventDefault();

          // 모든 섹션 숨기고 선택된 섹션만 표시
          document.querySelectorAll('[data-section]').forEach(section => {
            section.style.display = section.id === s.id ? '' : 'none';
          });

          const targetEl = document.getElementById(s.id);
          if(targetEl) {
            targetEl.scrollIntoView({behavior:'smooth', block:'start'});
            history.pushState(null, null, `#${s.id}`);
          }

          state.currentSection = s.id;
          localStorage.setItem('currentSection', s.id);
          updateCurrentTOC();
        });
        toc.appendChild(a);
      });

      const root = document.getElementById('manualContent'); root.innerHTML = '';
      DATA.sections.forEach((sec, index) => {
        const sectionEl = buildSection(sec);
        // 첫 번째 섹션만 표시, 나머지는 숨김
        if(index !== 0) {
          sectionEl.querySelector('[data-section]').style.display = 'none';
        }
        root.appendChild(sectionEl);
      });

      const filter = document.createElement('input');
      filter.id = 'sectionSearch'; filter.placeholder = '섹션/키워드 필터';
      filter.style.cssText = 'padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text);margin:12px 0;';
      document.querySelector('.appbar').appendChild(filter);
      filter.addEventListener('input', (e)=>{
        const v = e.target.value.trim().toLowerCase();
        Array.from(document.querySelectorAll('#manualContent [data-section]')).forEach(el=>{
          const text = (el.textContent||'').toLowerCase();
          el.style.display = v && !text.includes(v) ? 'none' : '';
        });
      });

      refreshStepProgress();
      refreshChecklistProgress();
    }

    function buildSection(sec){
      const t = document.importNode(document.getElementById('tpl-section').content, true);
      const $sec = t.querySelector('[data-section]');
      $sec.id = sec.id;
      t.querySelector('[data-emoji]').textContent = sec.emoji;
      t.querySelector('[data-text]').textContent = sec.title;
      t.querySelector('[data-meta]').textContent = sec.meta||'';
      t.querySelector('[data-body]').innerHTML = typeof sec.body==='function' ? sec.body({specs: DATA.vehicle.specs}) : (sec.body||'');

      observer.observe($sec);

      Array.from(t.querySelectorAll('#stdSteps [data-done]')).forEach((btn)=>{
        btn.addEventListener('click', ()=>{
          const host = btn.closest('[data-step]'); const id = Number(host.dataset.step);
          if(state.doneSteps.has(id)) state.doneSteps.delete(id); else state.doneSteps.add(id);
          localStorage.setItem('doneSteps', JSON.stringify([...state.doneSteps]));
          host.style.outline = state.doneSteps.has(id) ? '2px solid var(--ok)' : '';
          btn.textContent = state.doneSteps.has(id) ? '취소' : '완료';
          refreshStepProgress();
        });
      });

      return t;
    }

    function refreshStepProgress(){
      const total = 4; const done = state.doneSteps.size; const pct = Math.round(done/total*100);
      const bar = document.getElementById('stepProgress'); if(bar) bar.style.width = pct+'%';
    }
    function refreshChecklistProgress(){
      const all = document.querySelectorAll('#manualContent [data-checklist] input[type=\"checkbox\"]').length;
      const done = Object.values(state.checklist).filter(Boolean).length;
      const pct = all===0 ? 0 : Math.round(done/all*100);
      const bar = document.getElementById('checkProgress'); if(bar) bar.style.width = pct+'%';
    }

    function updateCurrentTOC(){
      Array.from(document.querySelectorAll('#toc a')).forEach(a=> a.setAttribute('aria-current', a.dataset.id===state.currentSection));
    }

    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){ state.currentSection = e.target.id; localStorage.setItem('currentSection', state.currentSection); updateCurrentTOC(); }
      });
    }, { rootMargin: '0px 0px -70% 0px', threshold: 0.1 });

    document.addEventListener('click', (e)=>{
      if(e.target.id==='backHome'){ document.getElementById('app').style.display='none'; document.getElementById('home').style.display='grid'; }
      if(e.target.id==='printBtn'){ window.print(); }
      if(e.target.id==='collapseAll'){ const open = document.querySelectorAll('details[open]').length>0; document.querySelectorAll('details').forEach(d=> open ? d.removeAttribute('open') : d.setAttribute('open','')); }
    });

    window.addEventListener('hashchange', ()=>{
      const id = location.hash.replace('#','');
      const el = document.getElementById(id);
      if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); state.currentSection=id; updateCurrentTOC(); }
    });
  })();
  </script>
<!-- build: v1.0 | 개선사항: TypeError 수정, smooth 스크롤, TOC 시각적 개선, 경고 메시지 추가 -->
</body>
</html>
