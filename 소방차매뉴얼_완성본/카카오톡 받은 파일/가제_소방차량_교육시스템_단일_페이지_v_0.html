<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>(가제)소방차량 교육시스템 — v0.7</title>
<style>
:root{--bg:#0b0c10;--panel:#14161a;--ink:#e9eef3;--muted:#9aa7b2;--acc:#38bdf8;--line:#1d2128}
*{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,Segoe UI,Roboto,Apple SD Gothic Neo}
header,footer{padding:12px 16px;background:#0f1115;border-bottom:1px solid var(--line)}
header h1{margin:0;font-size:18px}

/* 전체 레이아웃 */
#app{display:grid;grid-template-rows:auto auto 1fr auto;gap:10px;height:calc(100vh - 0px)}
.topbar{display:flex;gap:8px;align-items:center;padding:0 16px}

/* 단계형 선택 버튼(대→중→소→세) */
.stepper{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:0 16px}
.stepbtn{display:flex;justify-content:space-between;align-items:center;background:#0f141a;color:var(--ink);border:1px solid #28303a;border-radius:10px;padding:10px 12px;cursor:pointer}
.stepbtn[disabled]{opacity:.45;cursor:not-allowed}
.stepbtn .sub{color:var(--muted);font-size:12px;margin-left:6px}
.menu{position:relative}
.menu>div{position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10;background:#0f141a;border:1px solid #28303a;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);max-height:260px;overflow:auto;display:none}
.menu.open>div{display:block}
.menu .opt{padding:10px 12px;border-bottom:1px solid #1b2330;cursor:pointer}
.menu .opt:last-child{border-bottom:0}
.menu .opt:hover{background:#121b26}

/* 본문 3분할: 좌(부위버튼) / 중(3D/사진) / 우(정보패널) */
.main{display:grid;grid-template-columns:280px 1fr 380px;grid-template-rows:1fr;gap:10px;padding:0 16px 10px 16px}
.left{background:var(--panel);border:1px solid #1d2128;border-radius:14px;padding:10px;display:flex;flex-direction:column}
.left header{background:transparent;border:0;padding:0 0 8px 0}
.partgrid{display:grid;grid-template-columns:1fr;gap:8px;overflow:auto}
.partbtn{background:#121821;border:1px solid #2a313a;border-radius:10px;padding:10px;text-align:left;cursor:pointer}
.partbtn[disabled]{opacity:.45;cursor:not-allowed}

.viewer{background:#0f1115;border:1px solid #1d2128;border-radius:14px;display:grid;grid-template-rows:auto 1fr auto;min-height:560px}
.viewer header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px}
.mode button{background:#18202a;border:1px solid #2a313a;color:var(--ink);padding:6px 10px;border-radius:10px;cursor:pointer}
.mode button[aria-pressed="true"]{border-color:var(--acc)}
.canvas{display:grid;place-items:center;min-height:520px}
.canvas .ph{opacity:.8;text-align:center}
.thumbs{display:flex;gap:8px;overflow:auto;padding:10px;border-top:1px solid #1d2128}
.thumbs img{width:96px;height:72px;object-fit:cover;border-radius:8px;border:1px solid #2a313a;cursor:pointer}

.side{background:var(--panel);border:1px solid #1d2128;border-radius:14px;display:flex;flex-direction:column}
.tabs{display:flex;border-bottom:1px solid #1d2128}
.tabs button{flex:1;padding:10px;background:transparent;border:0;color:var(--muted);cursor:pointer}
.tabs button.active{color:var(--ink);border-bottom:2px solid var(--acc)}
.pane{padding:12px;overflow:auto;flex:1}
.stepbar{display:flex;gap:6px;align-items:center;padding:8px;border-top:1px solid #1d2128}
.chip{padding:4px 8px;border:1px solid #2a313a;border-radius:999px;color:var(--muted)}
.btn{background:#18202a;border:1px solid #2a313a;border-radius:10px;color:var(--ink);padding:8px 12px;cursor:pointer}
.btn[disabled]{opacity:.45;cursor:not-allowed}

/* 반응형 */
@media (max-width:1180px){ .main{grid-template-columns:240px 1fr 340px} }
@media (max-width:980px){ .stepper{grid-template-columns:1fr} .main{grid-template-columns:1fr;grid-template-rows:auto auto auto} }
</style>
</head>
<body>
<header>
  <h1>(가제)소방차량 교육시스템</h1>
</header>
<div id="app">
  <!-- 상단 가이드 -->
  <div class="topbar">
    <small class="muted">소방차량에 한해 단계 선택 → 부위 선택 → 3D/사진 확인 → 우측 패널로 학습</small>
  </div>

  <!-- 단계형 선택 버튼 행 -->
  <div class="stepper" aria-label="분류 선택">
    <div class="menu" id="m-cat">
      <button class="stepbtn" id="btn-cat"><span>소방차량</span><span class="sub" id="txt-cat">대분류 선택</span>▾</button>
      <div id="list-cat"></div>
    </div>
    <div class="menu" id="m-mid">
      <button class="stepbtn" id="btn-mid" disabled><span>중분류</span><span class="sub" id="txt-mid">먼저 대분류</span>▾</button>
      <div id="list-mid"></div>
    </div>
    <div class="menu" id="m-small">
      <button class="stepbtn" id="btn-small" disabled><span>소분류</span><span class="sub" id="txt-small">먼저 중분류</span>▾</button>
      <div id="list-small"></div>
    </div>
    <div class="menu" id="m-grade">
      <button class="stepbtn" id="btn-grade" disabled><span>세분류</span><span class="sub" id="txt-grade">먼저 소분류</span>▾</button>
      <div id="list-grade"></div>
    </div>
  </div>

  <!-- 본문: 좌(부위) / 중(3D/사진) / 우(정보) -->
  <div class="main">
    <aside class="left" aria-label="부위/섹션">
      <header><strong>부위 선택</strong><br><small class="muted">세분류 선택 시 활성화</small></header>
      <div class="partgrid" id="parts">
        <!-- 활성화되면 버튼 on -->
        <button class="partbtn" disabled>외관 360°</button>
        <button class="partbtn" disabled>본넷(엔진룸)</button>
        <button class="partbtn" disabled>펌프실</button>
        <button class="partbtn" disabled>운전석</button>
        <button class="partbtn" disabled>장비함(좌/우)</button>
        <button class="partbtn" disabled>상부함/하부함</button>
        <button class="partbtn" disabled>폼 장치</button>
        <button class="partbtn" disabled>겨울 관리</button>
      </div>
    </aside>

    <section class="viewer" aria-label="3D/사진">
      <header>
        <strong id="selTitle">차량을 선택하세요</strong>
        <div class="mode" role="group" aria-label="보기 모드">
          <button id="btn-360" aria-pressed="true">360° 보기</button>
          <button id="btn-photos" aria-pressed="false">사진 나열</button>
        </div>
      </header>
      <div class="canvas" id="canvas">
        <div class="ph" id="ph-360">
          <h2>360°/3D 뷰어</h2>
          <p class="muted">세분류 선택 후, 좌측 부위 버튼으로 세부 학습을 진행하세요.</p>
        </div>
        <div class="ph" id="ph-photos" hidden>
          <h2>사진 나열 모드</h2>
          <p class="muted">썸네일을 클릭해 확대/설명 확인</p>
        </div>
      </div>
      <div class="thumbs" id="thumbs" aria-label="사진 썸네일">
        <img src="https://placehold.co/200x150?text=외관" alt="외관" tabindex="0" onclick="openPhoto('외관')">
        <img src="https://placehold.co/200x150?text=펌프실" alt="펌프실" tabindex="0" onclick="openPhoto('펌프실')">
        <img src="https://placehold.co/200x150?text=운전석" alt="운전석" tabindex="0" onclick="openPhoto('운전석')">
      </div>
    </section>

    <aside class="side" aria-label="정보 패널">
      <div class="tabs">
        <button class="active" data-tab="desc">설명</button>
        <button data-tab="specs">스펙</button>
        <button data-tab="modules">교육모듈</button>
        <button data-tab="check">체크</button>
      </div>
      <section class="pane" id="pane-desc">
        <h3>가이드</h3>
        <p>상단에서 <strong>소방차량</strong> 분류를 대→중→소→세 순으로 선택하세요. 좌측에서 보고 싶은 <em>부위</em>를 선택하면 중앙 3D/사진과 연동되고, 우측에서 설명·스펙·모듈·체크를 확인합니다.</p>
      </section>
      <section class="pane" id="pane-specs" hidden><p class="muted">차량 제원(톤급/펌프정격/탱크용량 등) 표시</p></section>
      <section class="pane" id="pane-modules" hidden><p class="muted">해당 차량의 교육 모듈(메인밸브/지수밸브/폼/겨울관리 등)</p></section>
      <section class="pane" id="pane-check" hidden>
        <label><input type="checkbox"> 안전장구 착용 확인</label><br>
        <label><input type="checkbox"> 주차브레이크/차륜정지 확인</label>
      </section>
      <div class="stepbar">
        <span class="chip" id="chip">선택 0/4</span>
        <div style="flex:1"></div>
        <button class="btn" id="openPlayer" disabled>학습 시작</button>
      </div>
    </aside>
  </div>

  <footer><small class="muted">v0.7 — 소방차량 전용. 3D/사진은 폴더형에서 GLTF/이미지 스핀으로 교체.</small></footer>
</div>

<script>
// --- 소방차량 카탈로그(기동장비만) ---
const catalog = {
  categories: [
    { id:'fire_vehicle', title:'소방차량', groups:[
      { mid:'pump', title:'펌프차', items:[ {sid:'pump_truck', title:'펌프차', grades:['경형','소형','중형','대형']} ] },
      { mid:'water_tanker', title:'물탱크차', items:[ {sid:'water_tanker', title:'물탱크차', grades:['소형','중형','대형']} ] },
      { mid:'aerial', title:'고가차', items:[ {sid:'ladder', title:'사다리차', grades:['33m급','46m급','53m급','68m급'] }, {sid:'platform', title:'굴절차', grades:['27m급','33m급','46m급','69m급'] } ] },
      { mid:'ems', title:'구급차', items:[ {sid:'ems_special', title:'특수구급차', grades:['소형','중형','대형']} ] },
      { mid:'rescue', title:'구조차', items:[ {sid:'workshop', title:'구조공작차', grades:['구조공작차','다목적구조차','수난구조차']} ] }
    ]}
  ]
};

// 상태
const state = { cat:null, mid:null, item:null, grade:null };

// 요소
const btnCat = document.getElementById('btn-cat');
const btnMid = document.getElementById('btn-mid');
const btnSmall = document.getElementById('btn-small');
const btnGrade = document.getElementById('btn-grade');
const listCat = document.getElementById('list-cat');
const listMid = document.getElementById('list-mid');
const listSmall = document.getElementById('list-small');
const listGrade = document.getElementById('list-grade');
const txtCat = document.getElementById('txt-cat');
const txtMid = document.getElementById('txt-mid');
const txtSmall = document.getElementById('txt-small');
const txtGrade = document.getElementById('txt-grade');
const crumbs = document.getElementById('chip');
const selTitle = document.getElementById('selTitle');
const openBtn = document.getElementById('openPlayer');

// 메뉴 열기/닫기
function toggleMenu(id){ document.getElementById(id).classList.toggle('open'); }
['m-cat','m-mid','m-small','m-grade'].forEach(id=>{ document.querySelector('#'+id+' .stepbtn').addEventListener('click', ()=> toggleMenu(id)); });
window.addEventListener('click', (e)=>{ document.querySelectorAll('.menu').forEach(m=>{ if(!m.contains(e.target)) m.classList.remove('open'); }); });

// 렌더 공통
function renderList(container, arr, onPick){ container.innerHTML=''; arr.forEach(v=>{ const d=document.createElement('div'); d.className='opt'; d.textContent=v.title||v; d.onclick=()=> onPick(v); container.appendChild(d); }); }

// 초기: 대분류=소방차량만
renderList(listCat, catalog.categories, (c)=>{
  state.cat=c; state.mid=null; state.item=null; state.grade=null;
  txtCat.textContent=c.title; txtMid.textContent='중분류 선택'; txtSmall.textContent='소분류 선택'; txtGrade.textContent='세분류 선택';
  btnMid.disabled=false; btnSmall.disabled=true; btnGrade.disabled=true;
  renderList(listMid, c.groups||[], (m)=>{
    state.mid=m; state.item=null; state.grade=null;
    txtMid.textContent=m.title; txtSmall.textContent='소분류 선택'; txtGrade.textContent='세분류 선택';
    btnSmall.disabled=false; btnGrade.disabled=true;
    renderList(listSmall, m.items||[], (it)=>{
      state.item=it; state.grade=null; txtSmall.textContent=it.title; txtGrade.textContent='세분류 선택'; btnGrade.disabled=false;
      renderList(listGrade, it.grades||[], (g)=>{ state.grade=g; txtGrade.textContent=g; updateUI(); activateParts(true); });
      updateUI(); activateParts(false);
    });
    updateUI(); activateParts(false);
  });
  updateUI(); activateParts(false);
});

// 좌측 부위 버튼 활성화
function activateParts(on){ document.querySelectorAll('.partbtn').forEach((b,i)=>{ b.disabled = !on; b.onclick = on? ()=> focusPart(i) : null; }); }
function focusPart(i){
  const labels=['외관 360°','본넷(엔진룸)','펌프실','운전석','장비함(좌/우)','상부함/하부함','폼 장치','겨울 관리'];
  selTitle.textContent = `${[state.item?.title,state.grade].filter(Boolean).join(' ')} — ${labels[i]}`;
}

// 360°/사진 모드 토글
const btn360 = document.getElementById('btn-360');
const btnPhotos = document.getElementById('btn-photos');
const ph360 = document.getElementById('ph-360');
const phPhotos = document.getElementById('ph-photos');
btn360.onclick = ()=>{ btn360.setAttribute('aria-pressed','true'); btnPhotos.setAttribute('aria-pressed','false'); ph360.hidden=false; phPhotos.hidden=true; };
btnPhotos.onclick = ()=>{ btn360.setAttribute('aria-pressed','false'); btnPhotos.setAttribute('aria-pressed','true'); ph360.hidden=true; phPhotos.hidden=false; };

function updateUI(){
  const parts=[]; if(state.cat) parts.push(state.cat.title); if(state.mid) parts.push(state.mid.title); if(state.item) parts.push(state.item.title); if(state.grade) parts.push(state.grade);
  const count=(state.cat?1:0)+(state.mid?1:0)+(state.item?1:0)+(state.grade?1:0);
  crumbs.textContent = `선택 ${count}/4`;
  selTitle.textContent = parts.length? parts.join(' › '): '차량을 선택하세요';
  openBtn.disabled = !(state.cat && state.mid && state.item && state.grade);
  // 우측 패널 더미 데이터
  if(state.item){
    document.getElementById('pane-specs').innerHTML = `<ul><li><strong>분류</strong>: ${state.cat.title} / ${state.mid.title}</li><li><strong>모델</strong>: ${state.item.title} (${state.grade||'-'})</li><li><strong>예시 제원</strong>: 정격 2800LPM / 탱크 2500L</li></ul>`;
    document.getElementById('pane-modules').innerHTML = '<ul><li>메인밸브</li><li>지수밸브</li><li>폼 장치</li><li>겨울 관리</li></ul>';
  }
}

// 탭 전환
function setTab(which){ document.querySelectorAll('.tabs button').forEach(b=>{ const on=b.dataset.tab===which; b.classList.toggle('active',on); document.getElementById('pane-'+b.dataset.tab).hidden=!on; }); }
document.querySelectorAll('.tabs button').forEach(b=> b.onclick=()=> setTab(b.dataset.tab));

// 썸네일 데모
function openPhoto(label){ alert(label+' 사진 보기 (데모)'); }
window.openPhoto = openPhoto;

// 학습 시작(데모)
document.getElementById('openPlayer').onclick = ()=>{
  alert('학습 시작: '+[state.mid?.title,state.item?.title,state.grade].filter(Boolean).join(' › '));
};
</script>
</body>
</html>
